<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø­Ù„ Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
    <meta name="keywords" content="Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³ÙŠ, Ø¥Ø¯Ø§Ø±Ø© ØªÙ„Ø§Ù…ÙŠØ°, Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨, ØªÙ‚Ø§Ø±ÙŠØ± ØªØ¹Ù„ÙŠÙ…ÙŠØ©">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#006233">
    <link rel="apple-touch-icon" href="/icon-192x192.png">
    
    <title>ğŸ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ | Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- External Libraries (Lazy Load) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* ========== CSS Variables ========== */
        :root {
            --primary-color: #006233;
            --primary-dark: #004d26;
            --primary-light: #e8f5e9;
            --secondary-color: #2196f3;
            --accent-color: #ff9800;
            --danger-color: #f44336;
            --success-color: #4caf50;
            --warning-color: #ffc107;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
            
            --gradient-primary: linear-gradient(135deg, #006233 0%, #2E7D32 100%);
            --gradient-secondary: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            --gradient-accent: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.15);
            --shadow-xl: 0 16px 48px rgba(0,0,0,0.2);
            
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }
        
        /* ========== Dark Mode ========== */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #00a85d;
                --dark-color: #ffffff;
                --light-color: #121212;
                --gray-color: #b0b0b0;
            }
            body {
                background: #121212;
                color: #ffffff;
            }
            .card {
                background: #1e1e1e;
                border: 1px solid #333;
            }
            table {
                background: #1e1e1e;
            }
            td {
                border-color: #333;
            }
        }
        
        /* ========== Reset & Base ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Cairo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        /* ========== Custom Scrollbar ========== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* ========== Preloader ========== */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity var(--transition-normal);
        }
        
        .preloader-content {
            text-align: center;
            color: white;
        }
        
        .loader {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        /* ========== Header ========== */
        .glass-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary-color);
            margin: 0;
        }
        
        .logo-text p {
            font-size: 14px;
            color: var(--gray-color);
            margin: 0;
        }
        
        /* ========== Container & Layout ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ========== Cards ========== */
        .card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-title {
            font-size: 22px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* ========== Buttons ========== */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius-md);
            font-family: 'Cairo', sans-serif;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 98, 51, 0.3);
        }
        
        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: #333;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        /* ========== Forms ========== */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius-md);
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            transition: all var(--transition-normal);
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 98, 51, 0.1);
        }
        
        .input-group {
            display: flex;
            gap: 12px;
        }
        
        .input-group .form-control {
            flex: 1;
        }
        
        /* ========== Tables ========== */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 18px;
            font-weight: 700;
            text-align: center;
            position: relative;
        }
        
        .data-table th::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .data-table th:last-child::after {
            display: none;
        }
        
        .data-table td {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            text-align: center;
            transition: background var(--transition-fast);
        }
        
        .data-table tbody tr {
            transition: all var(--transition-fast);
        }
        
        .data-table tbody tr:hover {
            background: var(--primary-light);
            transform: scale(1.01);
        }
        
        /* ========== Badges ========== */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
        }
        
        .badge-success {
            background: #e8f5e9;
            color: var(--primary-color);
        }
        
        .badge-warning {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .badge-danger {
            background: #ffebee;
            color: var(--danger-color);
        }
        
        .badge-info {
            background: #e3f2fd;
            color: var(--secondary-color);
        }
        
        /* ========== Tabs ========== */
        .nav-tabs {
            display: flex;
            gap: 10px;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 14px 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 700;
            color: var(--gray-color);
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .nav-tab:hover {
            background: var(--primary-light);
            color: var(--primary-color);
        }
        
        .nav-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .nav-tab.active::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background: white;
            border-radius: 2px;
        }
        
        /* ========== Statistics Cards ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            border-top: 4px solid var(--primary-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-number {
            font-size: 42px;
            font-weight: 900;
            color: var(--primary-color);
            margin: 15px 0;
        }
        
        .stat-label {
            font-size: 16px;
            color: var(--gray-color);
            font-weight: 600;
        }
        
        /* ========== Charts ========== */
        .chart-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-md);
            margin-bottom: 25px;
        }
        
        /* ========== Alerts & Notifications ========== */
        .alert {
            padding: 18px 22px;
            border-radius: var(--border-radius-md);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-right: 5px solid;
        }
        
        .alert-success {
            background: #e8f5e9;
            border-right-color: var(--success-color);
            color: #1b5e20;
        }
        
        .alert-danger {
            background: #ffebee;
            border-right-color: var(--danger-color);
            color: #c62828;
        }
        
        .alert-warning {
            background: #fff3e0;
            border-right-color: var(--warning-color);
            color: #ef6c00;
        }
        
        .alert-info {
            background: #e3f2fd;
            border-right-color: var(--secondary-color);
            color: #1565c0;
        }
        
        /* ========== Utility Classes ========== */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .w-100 {
            width: 100%;
        }
        
        /* ========== Animations ========== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* ========== Responsive Design ========== */
        @media (max-width: 992px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 20px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo {
                flex-direction: column;
            }
            
            .card-title {
                font-size: 18px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .input-group {
                flex-direction: column;
            }
        }
        
        /* ========== Print Styles ========== */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="preloader-content">
            <div class="loader"></div>
            <h2 style="color: white; margin-bottom: 10px;">ğŸ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</h2>
            <p style="color: rgba(255,255,255,0.9);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-school"></i>
                </div>
                <div class="logo-text">
                    <h1>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</h1>
                    <p>Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</p>
                </div>
            </div>
            
            <div class="header-actions">
                <button id="themeToggle" class="btn btn-sm" style="background: var(--primary-light); color: var(--primary-color);">
                    <i class="fas fa-moon"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±
                </button>
                <button id="logoutBtn" class="btn btn-sm btn-danger hidden">
                    <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Authentication Section -->
         <section id="authSection" class="card fade-in">
            <div class="card-title">
                <i class="fas fa-lock"></i> Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù…Ù†Ø©
            </div>
            
            <div id="authAlert" class="alert hidden"></div>
            
            <div class="form-group">
                <label class="form-label" for="email">
                    <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                </label>
                <input type="email" id="email" class="form-control" placeholder="example@school.edu" required>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="password">
                    <i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                </label>
                <div style="position: relative;">
                    <input type="password" id="password" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    <button type="button" id="togglePassword" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray-color); cursor: pointer;">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="userRole">
                    <i class="fas fa-user-tag"></i> Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨
                </label>
                <select id="userRole" class="form-control" required>
                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
                    <option value="admin">ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</option>
                    <option value="advisor">ğŸ“ Ù…Ø³ØªØ´Ø§Ø± ØªØ±Ø¨ÙˆÙŠ</option>
                    <option value="teacher">ğŸ‘¨â€ğŸ« Ø£Ø³ØªØ§Ø°</option>
                    <option value="student">ğŸ‘¨â€ğŸ“ ØªÙ„Ù…ÙŠØ°</option>
                    <option value="parent">ğŸ‘¨â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø£Ù…Ø±</option>
                </select>
            </div>
            
            <div class="input-group mt-20">
                <button id="loginBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                <button id="registerBtn" class="btn btn-secondary">
                    <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
            
            <div class="text-center mt-20" style="color: var(--gray-color); font-size: 14px;">
                <i class="fas fa-shield-alt"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙØ±Ø© ÙˆÙÙ‚ Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            </div>
        </section>

        <!-- School Setup Section -->
        <section id="schoolSetupSection" class="card hidden">
            <div class="card-title">
                <i class="fas fa-school"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
            </div>
            
            <div class="form-group">
                <label class="form-label" for="schoolName">Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</label>
                <input type="text" id="schoolName" class="form-control" placeholder="Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„ØªÙ…ÙŠØ²">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="schoolCode">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù„Ù…Ø¤Ø³Ø³Ø©</label>
                <input type="text" id="schoolCode" class="form-control" placeholder="123456">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="province">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label>
                <select id="province" class="form-control">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</option>
                    <option value="algiers">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
                    <option value="oran">ÙˆÙ‡Ø±Ø§Ù†</option>
                    <option value="constantine">Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©</option>
                    <option value="annaba">Ø¹Ù†Ø§Ø¨Ø©</option>
                    <option value="blida">Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©</option>
                    <option value="setif">Ø³Ø·ÙŠÙ</option>
                    <option value="batna">Ø¨Ø§ØªÙ†Ø©</option>
                    <option value="djelfa">Ø§Ù„Ø¬Ù„ÙØ©</option>
                    <option value="tiaret">ØªÙŠØ§Ø±Øª</option>
                    <option value="bejaia">Ø¨Ø¬Ø§ÙŠØ©</option>
                    <option value="skikda">Ø³ÙƒÙŠÙƒØ¯Ø©</option>
                    <option value="tlemcen">ØªÙ„Ù…Ø³Ø§Ù†</option>
                    <option value="ghardaia">ØºØ±Ø¯Ø§ÙŠØ©</option>
                    <option value="laghouat">Ø§Ù„Ø£ØºÙˆØ§Ø·</option>
                    <option value="mostaganem">Ù…Ø³ØªØºØ§Ù†Ù…</option>
                    <option value="msila">Ø§Ù„Ù…Ø³ÙŠÙ„Ø©</option>
                    <option value="saida">Ø§Ù„Ø³Ø¹ÙŠØ¯Ø©</option>
                    <option value="eloued">Ø§Ù„ÙˆØ§Ø¯ÙŠ</option>
                    <option value="tindouf">ØªÙ†Ø¯ÙˆÙ</option>
                    <option value="tamanrasset">ØªÙ…Ù†Ø±Ø§Ø³Øª</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label" for="schoolPhone">Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</label>
                <input type="tel" id="schoolPhone" class="form-control" placeholder="023123456">
            </div>
            
            <button id="saveSchoolBtn" class="btn btn-primary w-100">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
            </button>
        </section>

        <!-- File Upload Section -->
        <section id="uploadSection" class="card hidden">
            <div class="card-title">
                <i class="fas fa-cloud-upload-alt"></i> Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong> ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨ØµÙŠØºØ© Excel (xlsx) ÙˆØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            </div>
            
            <div class="form-group">
                <label class="form-label" for="studentsFile">
                    <i class="fas fa-users"></i> Ù…Ù„Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°
                    <small style="color: var(--gray-color); display: block; margin-top: 5px;">
                        ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: Ø§Ù„Ù„Ù‚Ø¨ØŒ Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‚Ø³Ù…ØŒ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ØŒ Ø§Ù„Ø¬Ù†Ø³ØŒ Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
                    </small>
                </label>
                <input type="file" id="studentsFile" class="form-control" accept=".xlsx,.xls">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="teachersFile">
                    <i class="fas fa-chalkboard-teacher"></i> Ù…Ù„Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
                    <small style="color: var(--gray-color); display: block; margin-top: 5px;">
                        ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø§Ù„Ù‡Ø§ØªÙ
                    </small>
                </label>
                <input type="file" id="teachersFile" class="form-control" accept=".xlsx,.xls">
            </div>
            
            <div class="input-group">
                <button id="downloadTemplateBtn" class="btn btn-secondary">
                    <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø§Ù‡Ø²Ø©
                </button>
                <button id="uploadFilesBtn" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>
            
            <div id="uploadProgress" class="hidden mt-20">
                <div style="background: #f0f0f0; border-radius: var(--border-radius-md); height: 12px; overflow: hidden;">
                    <div id="progressBar" style="height: 100%; width: 0%; background: var(--gradient-primary); transition: width 0.3s;"></div>
                </div>
                <div class="text-center mt-10" style="color: var(--gray-color);">
                    <span id="progressText">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
                    <span id="progressPercent" style="font-weight: bold; margin-right: 10px;">0%</span>
                </div>
            </div>
        </section>

        <!-- Main Dashboard -->
        <section id="mainDashboard" class="hidden">
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-section="overview">
                    <i class="fas fa-tachometer-alt"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
                </button>
                <button class="nav-tab" data-section="students">
                    <i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°
                </button>
                <button class="nav-tab" data-section="teachers">
                    <i class="fas fa-chalkboard-teacher"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
                </button>
                <button class="nav-tab" data-section="attendance">
                    <i class="fas fa-clipboard-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨
                </button>
                <button class="nav-tab" data-section="grades">
                    <i class="fas fa-chart-line"></i> Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…
                </button>
                <button class="nav-tab" data-section="reports">
                    <i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
                <button id="adminTab" class="nav-tab hidden" data-section="admin">
                    <i class="fas fa-cogs"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
                </button>
            </div>

            <!-- Overview Section -->
            <div id="overview" class="dashboard-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">ğŸ‘¨â€ğŸ“ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</div>
                        <div style="margin-top: 15px; font-size: 14px; color: var(--success-color);">
                            <i class="fas fa-arrow-up"></i> Ø²ÙŠØ§Ø¯Ø© 5% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="totalTeachers">0</div>
                        <div class="stat-label">ğŸ‘¨â€ğŸ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</div>
                        <div style="margin-top: 15px; font-size: 14px; color: var(--success-color);">
                            <i class="fas fa-check-circle"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù†Ø´Ø·ÙŠÙ†
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="attendanceRate">98%</div>
                        <div class="stat-label">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                        <div style="margin-top: 15px; font-size: 14px; color: var(--success-color);">
                            <i class="fas fa-thumbs-up"></i> Ù†Ø³Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø©
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-number" id="avgGrade">16.5</div>
                        <div class="stat-label">â­ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</div>
                        <div style="margin-top: 15px; font-size: 14px; color: var(--accent-color);">
                            <i class="fas fa-trend-up"></i> ØªØ­Ø³Ù† 0.8 Ù†Ù‚Ø·Ø©
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px; font-size: 18px;">
                        <i class="fas fa-chart-pie"></i> Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                    </h3>
                    <canvas id="classesChart" height="250"></canvas>
                </div>

                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-bell"></i> Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙˆØ§Ù„Ù†Ø´Ø§Ø·Ø§Øª
                    </div>
                    <div id="recentActivities">
                        <div style="background: var(--primary-light); padding: 15px; border-radius: var(--border-radius-md); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 40px; height: 40px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div>
                                    <div style="font-weight: bold; color: var(--dark-color);">ØªÙ… Ø¥Ø¶Ø§ÙØ© 5 ØªÙ„Ø§Ù…ÙŠØ° Ø¬Ø¯Ø¯</div>
                                    <div style="color: var(--gray-color); font-size: 14px;">Ù‚Ø¨Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø© â€¢ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Management -->
            <div id="students" class="dashboard-section hidden">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <div class="card-title">
                            <i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <div style="position: relative;">
                                <input type="text" id="studentSearch" class="form-control" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† ØªÙ„Ù…ÙŠØ°..." style="width: 250px;">
                                <i class="fas fa-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gray-color);"></i>
                            </div>
                            <button id="addStudentBtn" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ°
                            </button>
                            <button id="exportStudentsBtn" class="btn btn-secondary">
                                <i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Excel
                            </button>
                        </div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                                    <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                    <th>ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTable">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                        <div>
                            Ø¹Ø±Ø¶
                            <select id="pageSize" style="padding: 8px; border-radius: var(--border-radius-sm); border: 1px solid #ddd;">
                                <option value="10">10</option>
                                <option value="25" selected>25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            Ø³Ø¬Ù„Ø§Øª
                        </div>
                        <div>
                            <button id="prevPageBtn" class="btn btn-sm">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                            <span style="margin: 0 15px;">ØµÙØ­Ø© <span id="currentPage">1</span> Ù…Ù† <span id="totalPages">1</span></span>
                            <button id="nextPageBtn" class="btn btn-sm">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Teachers Management -->
            <div id="teachers" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chalkboard-teacher"></i> Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                                    <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="teachersTable">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance Management -->
            <div id="attendance" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-clipboard-check"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="attendanceDate">
                            <i class="fas fa-calendar-alt"></i> Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
                        </label>
                        <input type="date" id="attendanceDate" class="form-control" value="">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="attendanceClass">
                            <i class="fas fa-users-class"></i> Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…
                        </label>
                        <select id="attendanceClass" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                        </select>
                    </div>
                    
                    <div id="attendanceTableContainer" style="margin-top: 20px;">
                        <p class="text-center" style="color: var(--gray-color);">
                            Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù‚Ø³Ù… Ù„Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
                        </p>
                    </div>
                    
                    <button id="saveAttendanceBtn" class="btn btn-primary w-100 mt-20">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±
                    </button>
                </div>
            </div>

            <!-- Grades Management -->
            <div id="grades" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="gradesClass">
                            <i class="fas fa-users-class"></i> Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…
                        </label>
                        <select id="gradesClass" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="gradesSubject">
                            <i class="fas fa-book"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©
                        </label>
                        <select id="gradesSubject" class="form-control">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                            <option value="math">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                            <option value="science">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
                            <option value="arabic">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="french">Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</option>
                            <option value="history">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                            <option value="geography">Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                            <option value="islamic">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <div id="gradesTableContainer" style="margin-top: 20px;">
                        <p class="text-center" style="color: var(--gray-color);">
                            Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„Ù…Ø§Ø¯Ø© Ù„Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                        </p>
                    </div>
                    
                    <button id="saveGradesBtn" class="btn btn-primary w-100 mt-20">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                    </button>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    </div>
                    
                    <div class="input-group">
                        <select id="reportType" class="form-control">
                            <option value="attendance">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</option>
                            <option value="grades">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option>
                            <option value="students">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</option>
                            <option value="teachers">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</option>
                            <option value="monthly">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</option>
                            <option value="annual">ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ</option>
                        </select>
                        
                        <input type="month" id="reportMonth" class="form-control" value="">
                        
                        <select id="reportClass" class="form-control">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                        </select>
                    </div>
                    
                    <div class="input-group mt-20">
                        <button id="generateReportBtn" class="btn btn-primary">
                            <i class="fas fa-cogs"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button id="printReportBtn" class="btn btn-secondary">
                            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button id="exportReportBtn" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                        </button>
                    </div>
                    
                    <div id="reportOutput" class="mt-20" style="min-height: 300px;">
                        <!-- Report content will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-cogs"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="card" style="padding: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                            </h4>
                            <div id="usersList" class="empty-state">
                                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-database"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                            </h4>
                            <div id="systemStats">
                                <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: <strong id="totalUsers">0</strong></p>
                                <p>Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: <strong id="activeStudents">0</strong></p>
                                <p>Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: <strong id="activeTeachers">0</strong></p>
                                <p>Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: <strong id="lastBackup">ØºÙŠØ± Ù…ØªÙˆÙØ±</strong></p>
                                <p>Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†: <strong id="storageUsed">0 MB</strong></p>
                            </div>
                            
                            <button id="backupBtn" class="btn btn-primary w-100 mt-20">
                                <i class="fas fa-database"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                            </button>
                        </div>
                        
                        <div class="card" style="padding: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-sliders-h"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
                            </h4>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</label>
                                <input type="text" class="form-control" id="systemName" value="Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø¯Ø¹Ù…</label>
                                <input type="email" class="form-control" id="supportEmail" value="support@schoolsystem.edu">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¯Ø¹Ù…</label>
                                <input type="tel" class="form-control" id="supportPhone" value="0551234567">
                            </div>
                            <button id="saveSettingsBtn" class="btn btn-primary w-100">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer style="text-align: center; padding: 30px; color: var(--gray-color); border-top: 1px solid #eee; margin-top: 40px;">
        <div style="max-width: 800px; margin: 0 auto;">
            <p style="font-size: 16px; margin-bottom: 10px;">
                <strong>ğŸ« Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</strong>
            </p>
            <p style="font-size: 14px; margin-bottom: 20px;">
                Ø§Ù„Ø­Ù„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© | Ø§Ù„Ø¥ØµØ¯Ø§Ø± 3.0 Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            </p>
            <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
                <a href="#" style="color: var(--primary-color); text-decoration: none;">
                    <i class="fas fa-shield-alt"></i> Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
                </a>
                <a href="#" style="color: var(--primary-color); text-decoration: none;">
                    <i class="fas fa-file-contract"></i> Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                </a>
                <a href="#" style="color: var(--primary-color); text-decoration: none;">
                    <i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
                </a>
            </div>
            <p style="font-size: 12px;">
                Â© 2024 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª
            </p>
        </div>
    </footer>

    <!-- FAB for Quick Actions -->
    <div class="fab-container" style="position: fixed; bottom: 30px; left: 30px; z-index: 1000;">
        <button id="fabBtn" class="btn btn-primary" style="width: 60px; height: 60px; border-radius: 50%; padding: 0; font-size: 24px;">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>

    <!-- JavaScript Application -->
    <script type="module">
        // ============================================
        // FIREBASE CONFIGURATION (Replace with your config)
        // ============================================
        const firebaseConfig = {
  apiKey: "AIzaSyCVzCCaJG2c_Mns3d788NM6Ifj_QiyVkk8",
  authDomain: "education-algeria.firebaseapp.com",
  projectId: "education-algeria",
  storageBucket: "education-algeria.firebasestorage.app",
  messagingSenderId: "329772568704",
  appId: "1:329772568704:web:ad98730f6789bfd3469665",
  measurementId: "G-039JRCKDET"
};
        // ============================================
        // IMPORT FIREBASE MODULES
        // ============================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged, 
            signOut,
            updateProfile 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDoc, 
            getDocs, 
            updateDoc, 
            deleteDoc,
            query, 
            where, 
            orderBy,
            serverTimestamp,
            addDoc,
            writeBatch
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // ============================================
        // INITIALIZE FIREBASE
        // ============================================
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // ============================================
        // APPLICATION STATE
        // ============================================
        const AppState = {
            currentUser: null,
            userRole: null,
            currentSchool: null,
            students: [],
            teachers: [],
            classes: [],
            currentPage: 1,
            itemsPerPage: 25,
            theme: localStorage.getItem('theme') || 'light'
        };

        // ============================================
        // DOM ELEMENTS
        // ============================================
        const elements = {
            // Sections
            preloader: document.getElementById('preloader'),
            authSection: document.getElementById('authSection'),
            schoolSetupSection: document.getElementById('schoolSetupSection'),
            uploadSection: document.getElementById('uploadSection'),
            mainDashboard: document.getElementById('mainDashboard'),
            
            // Auth
            email: document.getElementById('email'),
            password: document.getElementById('password'),
            userRole: document.getElementById('userRole'),
            loginBtn: document.getElementById('loginBtn'),
            registerBtn: document.getElementById('registerBtn'),
            togglePassword: document.getElementById('togglePassword'),
            logoutBtn: document.getElementById('logoutBtn'),
            themeToggle: document.getElementById('themeToggle'),
            
            // School Setup
            schoolName: document.getElementById('schoolName'),
            schoolCode: document.getElementById('schoolCode'),
            province: document.getElementById('province'),
            schoolPhone: document.getElementById('schoolPhone'),
            saveSchoolBtn: document.getElementById('saveSchoolBtn'),
            
            // File Upload
            studentsFile: document.getElementById('studentsFile'),
            teachersFile: document.getElementById('teachersFile'),
            downloadTemplateBtn: document.getElementById('downloadTemplateBtn'),
            uploadFilesBtn: document.getElementById('uploadFilesBtn'),
            uploadProgress: document.getElementById('uploadProgress'),
            progressBar: document.getElementById('progressBar'),
            progressText: document.getElementById('progressText'),
            progressPercent: document.getElementById('progressPercent'),
            
            // Navigation
            navTabs: document.querySelectorAll('.nav-tab'),
            adminTab: document.getElementById('adminTab'),
            
            // Overview
            totalStudents: document.getElementById('totalStudents'),
            totalTeachers: document.getElementById('totalTeachers'),
            attendanceRate: document.getElementById('attendanceRate'),
            avgGrade: document.getElementById('avgGrade'),
            
            // Students
            studentSearch: document.getElementById('studentSearch'),
            addStudentBtn: document.getElementById('addStudentBtn'),
            exportStudentsBtn: document.getElementById('exportStudentsBtn'),
            studentsTable: document.getElementById('studentsTable'),
            pageSize: document.getElementById('pageSize'),
            currentPage: document.getElementById('currentPage'),
            totalPages: document.getElementById('totalPages'),
            prevPageBtn: document.getElementById('prevPageBtn'),
            nextPageBtn: document.getElementById('nextPageBtn'),
            
            // Teachers
            teachersTable: document.getElementById('teachersTable'),
            
            // Attendance
            attendanceDate: document.getElementById('attendanceDate'),
            attendanceClass: document.getElementById('attendanceClass'),
            attendanceTableContainer: document.getElementById('attendanceTableContainer'),
            saveAttendanceBtn: document.getElementById('saveAttendanceBtn'),
            
            // Grades
            gradesClass: document.getElementById('gradesClass'),
            gradesSubject: document.getElementById('gradesSubject'),
            gradesTableContainer: document.getElementById('gradesTableContainer'),
            saveGradesBtn: document.getElementById('saveGradesBtn'),
            
            // Reports
            reportType: document.getElementById('reportType'),
            reportMonth: document.getElementById('reportMonth'),
            reportClass: document.getElementById('reportClass'),
            generateReportBtn: document.getElementById('generateReportBtn'),
            printReportBtn: document.getElementById('printReportBtn'),
            exportReportBtn: document.getElementById('exportReportBtn'),
            reportOutput: document.getElementById('reportOutput'),
            
            // Admin
            usersList: document.getElementById('usersList'),
            systemStats: document.getElementById('systemStats'),
            backupBtn: document.getElementById('backupBtn'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            
            // FAB
            fabBtn: document.getElementById('fabBtn'),
            
            // Alerts
            authAlert: document.getElementById('authAlert')
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        class Utils {
            static showNotification(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `alert alert-${type}`;
                notification.style.cssText = `
                    animation: fadeIn 0.3s ease;
                    margin-bottom: 10px;
                    cursor: pointer;
                    position: relative;
                    z-index: 2000;
                `;
                
                const icon = type === 'success' ? 'check-circle' : 
                            type === 'error' ? 'exclamation-circle' : 
                            type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                
                notification.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                    <button style="margin-right: auto; background: none; border: none; color: inherit; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                const container = document.getElementById('notificationContainer');
                if (!container) return;
                
                container.appendChild(notification);
                
                // Close button
                notification.querySelector('button').addEventListener('click', () => notification.remove());
                
                // Auto remove
                if (duration > 0) {
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.style.opacity = '0';
                            setTimeout(() => notification.remove(), 300);
                        }
                    }, duration);
                }
            }

            static formatDate(date) {
                if (!date) return '';
                const d = new Date(date);
                return d.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            static formatNumber(num) {
                return new Intl.NumberFormat('ar-EG').format(num);
            }

            static debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            static validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            static escapeHTML(str) {
                if (str === null || str === undefined) return '';
                return String(str)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;');
            }

            static async readExcelFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                            const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                            resolve(jsonData);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsArrayBuffer(file);
                });
            }
        }

        // ============================================
        // AUTHENTICATION MANAGER
        // ============================================
        class AuthManager {
            static async register(email, password, role) {
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    // Save user data to Firestore
                    await setDoc(doc(db, 'users', user.uid), {
                        email,
                        role,
                        createdAt: serverTimestamp(),
                        lastLogin: serverTimestamp(),
                        status: 'active'
                    });
                    
                    Utils.showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    return user;
                } catch (error) {
                    console.error('Registration error:', error);
                    Utils.showNotification(this.getAuthErrorMessage(error), 'error');
                    return null;
                }
            }

            static async login(email, password) {
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    // Update last login
                    await updateDoc(doc(db, 'users', user.uid), {
                        lastLogin: serverTimestamp()
                    });
                    
                    // Get user role
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        AppState.userRole = userDoc.data().role;
                    }
                    
                    AppState.currentUser = user;
                    Utils.showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    return user;
                } catch (error) {
                    console.error('Login error:', error);
                    Utils.showNotification(this.getAuthErrorMessage(error), 'error');
                    return null;
                }
            }

            static async logout() {
                try {
                    await signOut(auth);
                    AppState.currentUser = null;
                    AppState.userRole = null;
                    AppState.currentSchool = null;
                    
                    elements.authSection.classList.remove('hidden');
                    elements.mainDashboard.classList.add('hidden');
                    elements.logoutBtn.classList.add('hidden');
                    
                    Utils.showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }

            static getAuthErrorMessage(error) {
                const messages = {
                    'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
                    'auth/invalid-email': 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­',
                    'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©',
                    'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                    'auth/user-not-found': 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
                    'auth/network-request-failed': 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©'
                };
                return messages[error.code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
            }
        }

        // ============================================
        // SCHOOL MANAGER
        // ============================================
        class SchoolManager {
    static async createSchool(data) {
        try {
            if (!data.name || !data.code) {
                throw new Error('Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ±Ù‚Ù…Ù‡Ø§ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†');
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù…Ù‹Ø§)
            if (!/^\d+$/.test(data.code)) {
                throw new Error('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù„Ù…Ø¤Ø³Ø³Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ ÙÙ‚Ø·');
            }
            
            const schoolRef = doc(db, 'schools', data.code);
            const schoolDoc = await getDoc(schoolRef);
            
            if (schoolDoc.exists()) {
                throw new Error('Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø¢Ø®Ø±');
            }
            
            const schoolData = {
                ...data,
                adminId: AppState.currentUser.uid,
                adminEmail: AppState.currentUser.email,
                createdAt: serverTimestamp(),
                updatedAt: serverTimestamp(),
                totalStudents: 0,
                totalTeachers: 0,
                status: 'active'
            };
            
            await setDoc(schoolRef, schoolData);
            
            await updateDoc(doc(db, 'users', AppState.currentUser.uid), {
                schoolCode: data.code,
                schoolName: data.name,
                schoolProvince: data.province
            });
            
            AppState.currentSchool = { id: data.code, ...schoolData };
            localStorage.setItem('currentSchool', JSON.stringify({
                id: data.code,
                name: data.name,
                code: data.code,
                province: data.province
            }));
            
            console.log('School created successfully:', data.code);
            return true;
            
        } catch (error) {
            console.error('Create school error:', error);
            Utils.showNotification(error.message, 'error');
            return false;
        }
    }
    
    static async loadSchool(schoolCode) {
        try {
            const schoolRef = doc(db, 'schools', schoolCode);
            const schoolDoc = await getDoc(schoolRef);
            
            if (schoolDoc.exists()) {
                const schoolData = schoolDoc.data();
                AppState.currentSchool = { 
                    id: schoolDoc.id, 
                    ...schoolData 
                };
                
                localStorage.setItem('currentSchool', JSON.stringify({
                    id: schoolDoc.id,
                    name: schoolData.name,
                    code: schoolData.code,
                    province: schoolData.province
                }));
                
                console.log('School loaded successfully:', schoolDoc.id);
                return true;
            } else {
                console.error('School document does not exist');
                return false;
            }
        } catch (error) {
            console.error('Load school error:', error);
            return false;
        }
    }
}

        // ============================================
        // STUDENTS MANAGER
        // ============================================
        class StudentsManager {
            static students = [];
            static filteredStudents = [];
            static currentPage = 1;
            static itemsPerPage = 25;

            static async loadStudents() {
                try {
                    if (!AppState.currentSchool) return;
                    
                    const studentsRef = collection(db, 'schools', AppState.currentSchool.id, 'students');
                    const querySnapshot = await getDocs(studentsRef);
                    
                    this.students = [];
                    querySnapshot.forEach((doc) => {
                        this.students.push({ id: doc.id, ...doc.data() });
                    });
                    
                    this.filteredStudents = [...this.students];
                    this.renderTable();
                    this.updateStats();
                    
                    return true;
                } catch (error) {
                    console.error('Load students error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°', 'error');
                    return false;
                }
            }

            static async addStudent(studentData) {
                try {
                    if (!AppState.currentSchool) return false;
                    
                    const studentRef = doc(collection(db, 'schools', AppState.currentSchool.id, 'students'));
                    const student = {
                        ...studentData,
                        schoolCode: AppState.currentSchool.id,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp(),
                        status: 'active'
                    };
                    
                    await setDoc(studentRef, student);
                    
                    // Update school statistics
                    await updateDoc(doc(db, 'schools', AppState.currentSchool.id), {
                        totalStudents: (AppState.currentSchool.totalStudents || 0) + 1
                    });
                    
                    this.students.unshift({ id: studentRef.id, ...student });
                    this.filteredStudents.unshift({ id: studentRef.id, ...student });
                    
                    this.renderTable();
                    this.updateStats();
                    
                    Utils.showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ„Ù…ÙŠØ° Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    return true;
                } catch (error) {
                    console.error('Add student error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ„Ù…ÙŠØ°', 'error');
                    return false;
                }
            }

            static async deleteStudent(studentId) {
                try {
                    await deleteDoc(doc(db, 'schools', AppState.currentSchool.id, 'students', studentId));
                    
                    // Update school statistics
                    await updateDoc(doc(db, 'schools', AppState.currentSchool.id), {
                        totalStudents: (AppState.currentSchool.totalStudents || 1) - 1
                    });
                    
                    this.students = this.students.filter(s => s.id !== studentId);
                    this.filteredStudents = this.filteredStudents.filter(s => s.id !== studentId);
                    
                    this.renderTable();
                    this.updateStats();
                    
                    Utils.showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ„Ù…ÙŠØ° Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    return true;
                } catch (error) {
                    console.error('Delete student error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙ„Ù…ÙŠØ°', 'error');
                    return false;
                }
            }

            static async updateStudent(studentId, data) {
                try {
                    await updateDoc(doc(db, 'schools', AppState.currentSchool.id, 'students', studentId), {
                        ...data,
                        updatedAt: serverTimestamp()
                    });
                    
                    const index = this.students.findIndex(s => s.id === studentId);
                    if (index !== -1) {
                        this.students[index] = { ...this.students[index], ...data };
                        this.filteredStudents[index] = { ...this.filteredStudents[index], ...data };
                    }
                    
                    this.renderTable();
                    
                    Utils.showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ° Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    return true;
                } catch (error) {
                    console.error('Update student error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ°', 'error');
                    return false;
                }
            }

            static searchStudents(query) {
                const searchTerm = query.toLowerCase().trim();
                
                if (!searchTerm) {
                    this.filteredStudents = [...this.students];
                } else {
                    this.filteredStudents = this.students.filter(student => 
                        (student.firstName && student.firstName.toLowerCase().includes(searchTerm)) ||
                        (student.lastName && student.lastName.toLowerCase().includes(searchTerm)) ||
                        (student.class && student.class.toLowerCase().includes(searchTerm)) ||
                        (student.parentPhone && student.parentPhone.includes(searchTerm))
                    );
                }
                
                this.currentPage = 1;
                this.renderTable();
            }

            static renderTable() {
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageStudents = this.filteredStudents.slice(startIndex, endIndex);
                
                let html = '';
                
                if (pageStudents.length === 0) {
                    html = `
                        <tr>
                            <td colspan="8" class="text-center" style="padding: 40px;">
                                <div style="font-size: 48px; color: #ddd; margin-bottom: 10px;">
                                    <i class="fas fa-users-slash"></i>
                                </div>
                                <div style="color: var(--gray-color);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</div>
                            </td>
                        </tr>
                    `;
                } else {
                    pageStudents.forEach((student, index) => {
                        const fullIndex = startIndex + index + 1;
                        const avatar = student.photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(student.firstName || '')}+${encodeURIComponent(student.lastName || '')}&background=006233&color=fff`;
                        
                        html += `
                            <tr>
                                <td>${fullIndex}</td>
                                <td>
                                    <img src="${avatar}" alt="${student.firstName}" 
                                         style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                </td>
                                <td>
                                    <strong>${student.firstName || ''} ${student.lastName || ''}</strong><br>
                                    <small style="color: var(--gray-color);">${student.id}</small>
                                </td>
                                <td>
                                    <span class="badge badge-success">${student.class || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                </td>
                                <td>${Utils.formatDate(student.birthDate)}</td>
                                <td>${student.parentPhone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</td>
                                <td>
                                    <span class="badge ${student.status === 'active' ? 'badge-success' : 'badge-danger'}">
                                        ${student.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}
                                    </span>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 5px; justify-content: center;">
                                        <button class="btn btn-sm btn-view" data-id="${student.id}"
                                                style="background: var(--primary-light); color: var(--primary-color);">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-edit" data-id="${student.id}"
                                                style="background: var(--warning-color); color: white;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-delete" data-id="${student.id}"
                                                style="background: var(--danger-color); color: white;">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    });
                }
                
                elements.studentsTable.innerHTML = html;
                this.attachEventListeners();
                this.updatePagination();
            }

            static attachEventListeners() {
                // View buttons
                elements.studentsTable.querySelectorAll('.btn-view').forEach(btn => {
                    btn.addEventListener('click', () => this.viewStudent(btn.dataset.id));
                });
                
                // Edit buttons
                elements.studentsTable.querySelectorAll('.btn-edit').forEach(btn => {
                    btn.addEventListener('click', () => this.editStudent(btn.dataset.id));
                });
                
                // Delete buttons
                elements.studentsTable.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', () => this.deleteStudent(btn.dataset.id));
                });
            }

            static updatePagination() {
                const totalPages = Math.max(1, Math.ceil(this.filteredStudents.length / this.itemsPerPage));
                
                elements.currentPage.textContent = this.currentPage;
                elements.totalPages.textContent = totalPages;
                elements.prevPageBtn.disabled = this.currentPage <= 1;
                elements.nextPageBtn.disabled = this.currentPage >= totalPages;
            }

            static viewStudent(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (!student) return;
                
                Swal.fire({
                    title: `${student.firstName} ${student.lastName}`,
                    html: `
                        <div style="text-align: right;">
                            <img src="${student.photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(student.firstName || '')}+${encodeURIComponent(student.lastName || '')}&background=006233&color=fff`}" 
                                 style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 20px;">
                            <p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${student.id}</p>
                            <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${student.class || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> ${Utils.formatDate(student.birthDate)}</p>
                            <p><strong>Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:</strong> ${student.parentPhone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            <p><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${student.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="${student.status === 'active' ? 'text-success' : 'text-danger'}">${student.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</span></p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> ${Utils.formatDate(student.createdAt?.toDate())}</p>
                        </div>
                    `,
                    icon: 'info',
                    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
                });
            }

            static async editStudent(studentId) {
                const student = this.students.find(s => s.id === studentId);
                if (!student) return;
                
                const { value: formValues } = await Swal.fire({
                    title: 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ°',
                    html: `
                        <input id="edit-firstName" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù…" value="${student.firstName || ''}">
                        <input id="edit-lastName" class="swal2-input" placeholder="Ø§Ù„Ù„Ù‚Ø¨" value="${student.lastName || ''}">
                        <input id="edit-class" class="swal2-input" placeholder="Ø§Ù„Ù‚Ø³Ù…" value="${student.class || ''}">
                        <input id="edit-birthDate" type="date" class="swal2-input" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯" value="${student.birthDate || ''}">
                        <input id="edit-parentPhone" class="swal2-input" placeholder="Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" value="${student.parentPhone || ''}">
                        <select id="edit-gender" class="swal2-input">
                            <option value="male" ${student.gender === 'male' ? 'selected' : ''}>Ø°ÙƒØ±</option>
                            <option value="female" ${student.gender === 'female' ? 'selected' : ''}>Ø£Ù†Ø«Ù‰</option>
                        </select>
                    `,
                    focusConfirm: false,
                    showCancelButton: true,
                    confirmButtonText: 'ØªØ­Ø¯ÙŠØ«',
                    cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                    preConfirm: () => {
                        return {
                            firstName: document.getElementById('edit-firstName').value,
                            lastName: document.getElementById('edit-lastName').value,
                            class: document.getElementById('edit-class').value,
                            birthDate: document.getElementById('edit-birthDate').value,
                            parentPhone: document.getElementById('edit-parentPhone').value,
                            gender: document.getElementById('edit-gender').value
                        };
                    }
                });
                
                if (formValues) {
                    await this.updateStudent(studentId, formValues);
                }
            }

            static async exportToExcel() {
                if (this.filteredStudents.length === 0) {
                    Utils.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                    return;
                }
                
                const exportData = this.filteredStudents.map(student => ({
                    'Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„': student.id,
                    'Ø§Ù„Ø§Ø³Ù…': student.firstName || '',
                    'Ø§Ù„Ù„Ù‚Ø¨': student.lastName || '',
                    'Ø§Ù„Ù‚Ø³Ù…': student.class || '',
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯': student.birthDate || '',
                    'Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': student.parentPhone || '',
                    'Ø§Ù„Ø¬Ù†Ø³': student.gender === 'male' ? 'Ø°ÙƒØ±' : student.gender === 'female' ? 'Ø£Ù†Ø«Ù‰' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    'Ø§Ù„Ø­Ø§Ù„Ø©': student.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'
                }));
                
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°');
                
                const fileName = `ØªÙ„Ø§Ù…ÙŠØ°_${AppState.currentSchool?.id || 'Ù…Ø¯Ø±Ø³Ø©'}_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                Utils.showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            }

            static updateStats() {
                if (elements.totalStudents) {
                    elements.totalStudents.textContent = Utils.formatNumber(this.students.length);
                }
            }
        }

        // ============================================
        // TEACHERS MANAGER (Similar structure)
        // ============================================
        class TeachersManager {
            static teachers = [];

            static async loadTeachers() {
                // Implementation similar to StudentsManager
            }

            // ... other methods
        }

        // ============================================
        // FILE UPLOAD MANAGER
        // ============================================
        class FileUploadManager {
            static async processExcelFiles() {
                const studentsFile = elements.studentsFile.files[0];
                const teachersFile = elements.teachersFile.files[0];
                
                if (!studentsFile || !teachersFile) {
                    Utils.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙÙŠ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° ÙˆØ§Ù„Ø£Ø³Ø§ØªØ°Ø©', 'warning');
                    return;
                }
                
                try {
                    elements.uploadProgress.classList.remove('hidden');
                    await this.updateProgress(10, 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°...');
                    
                    const studentsData = await Utils.readExcelFile(studentsFile);
                    await this.updateProgress(40, 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©...');
                    
                    const teachersData = await Utils.readExcelFile(teachersFile);
                    await this.updateProgress(70, 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    
                    // Save to Firebase
                    await this.saveToFirebase(studentsData, teachersData);
                    
                    await this.updateProgress(100, 'ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    Utils.showNotification('ØªÙ… Ø±ÙØ¹ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    setTimeout(() => {
                        elements.uploadProgress.classList.add('hidden');
                        UIManager.showDashboard();
                    }, 1000);
                    
                } catch (error) {
                    console.error('File upload error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª: ' + error.message, 'error');
                    elements.uploadProgress.classList.add('hidden');
                }
            }

            static async saveToFirebase(studentsData, teachersData) {
                const batch = writeBatch(db);
                
                // Save students
                for (const student of studentsData) {
                    const studentRef = doc(collection(db, 'schools', AppState.currentSchool.id, 'students'));
                    batch.set(studentRef, {
                        firstName: student['Ø§Ù„Ø§Ø³Ù…'] || student['firstName'] || '',
                        lastName: student['Ø§Ù„Ù„Ù‚Ø¨'] || student['lastName'] || '',
                        class: student['Ø§Ù„Ù‚Ø³Ù…'] || student['class'] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        birthDate: student['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯'] || student['birthDate'] || '',
                        gender: student['Ø§Ù„Ø¬Ù†Ø³'] || student['gender'] || '',
                        parentPhone: student['Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±'] || student['parentPhone'] || '',
                        schoolCode: AppState.currentSchool.id,
                        createdAt: serverTimestamp(),
                        status: 'active'
                    });
                }
                
                // Save teachers
                for (const teacher of teachersData) {
                    const teacherRef = doc(collection(db, 'schools', AppState.currentSchool.id, 'teachers'));
                    batch.set(teacherRef, {
                        fullName: teacher['Ø§Ù„Ø§Ø³Ù…'] || teacher['fullName'] || '',
                        subject: teacher['Ø§Ù„Ù…Ø§Ø¯Ø©'] || teacher['subject'] || '',
                        email: teacher['Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] || teacher['email'] || '',
                        phone: teacher['Ø§Ù„Ù‡Ø§ØªÙ'] || teacher['phone'] || '',
                        hireDate: teacher['ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†'] || teacher['hireDate'] || '',
                        schoolCode: AppState.currentSchool.id,
                        createdAt: serverTimestamp(),
                        status: 'active'
                    });
                }
                
                // Update school statistics
                const schoolRef = doc(db, 'schools', AppState.currentSchool.id);
                batch.update(schoolRef, {
                    totalStudents: studentsData.length,
                    totalTeachers: teachersData.length,
                    updatedAt: serverTimestamp()
                });
                
                await batch.commit();
            }

            static async updateProgress(percent, message) {
                if (elements.progressBar) {
                    elements.progressBar.style.width = percent + '%';
                }
                if (elements.progressText) {
                    elements.progressText.textContent = message;
                }
                if (elements.progressPercent) {
                    elements.progressPercent.textContent = Math.round(percent) + '%';
                }
                
                // Simulate delay for progress animation
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            static downloadTemplate() {
                const studentsTemplate = [
                    {
                        'Ø§Ù„Ù„Ù‚Ø¨': 'Ø§Ù„Ø¹Ø¨Ø³ÙŠ',
                        'Ø§Ù„Ø§Ø³Ù…': 'Ø£Ø­Ù…Ø¯',
                        'Ø§Ù„Ù‚Ø³Ù…': 'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯': '2015-01-15',
                        'Ø§Ù„Ø¬Ù†Ø³': 'Ø°ÙƒØ±',
                        'Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': '0551234567'
                    }
                ];
                
                const ws = XLSX.utils.json_to_sheet(studentsTemplate);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°');
                XLSX.writeFile(wb, 'Ù‚Ø§Ù„Ø¨_Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°.xlsx');
                
                Utils.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°', 'success');
            }
        }

        // ============================================
        // UI MANAGER
        // ============================================
        class UIManager {
            static init() {
                this.hidePreloader();
                this.setupEventListeners();
                this.setupAuthListener();
                this.setupDateDefaults();
            }

            static hidePreloader() {
                setTimeout(() => {
                    elements.preloader.style.opacity = '0';
                    setTimeout(() => {
                        elements.preloader.style.display = 'none';
                    }, 500);
                }, 1000);
            }

            static setupEventListeners() {
                // Theme toggle
                elements.themeToggle.addEventListener('click', () => this.toggleTheme());
                
                // Auth events
                elements.loginBtn.addEventListener('click', () => this.handleLogin());
                elements.registerBtn.addEventListener('click', () => this.handleRegister());
                elements.togglePassword.addEventListener('click', () => this.togglePasswordVisibility());
                elements.logoutBtn.addEventListener('click', () => AuthManager.logout());
                
                // School setup
                elements.saveSchoolBtn.addEventListener('click', () => this.handleSaveSchool());
                
                // File upload
                elements.downloadTemplateBtn.addEventListener('click', () => FileUploadManager.downloadTemplate());
                elements.uploadFilesBtn.addEventListener('click', () => FileUploadManager.processExcelFiles());
                
                // Navigation
                elements.navTabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchSection(tab.dataset.section));
                });
                
                // Students
                elements.studentSearch.addEventListener('input', 
                    Utils.debounce(() => StudentsManager.searchStudents(elements.studentSearch.value), 300)
                );
                elements.addStudentBtn.addEventListener('click', () => this.showAddStudentModal());
                elements.exportStudentsBtn.addEventListener('click', () => StudentsManager.exportToExcel());
                elements.pageSize.addEventListener('change', () => {
                    StudentsManager.itemsPerPage = parseInt(elements.pageSize.value);
                    StudentsManager.currentPage = 1;
                    StudentsManager.renderTable();
                });
                elements.prevPageBtn.addEventListener('click', () => {
                    if (StudentsManager.currentPage > 1) {
                        StudentsManager.currentPage--;
                        StudentsManager.renderTable();
                    }
                });
                elements.nextPageBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(StudentsManager.filteredStudents.length / StudentsManager.itemsPerPage);
                    if (StudentsManager.currentPage < totalPages) {
                        StudentsManager.currentPage++;
                        StudentsManager.renderTable();
                    }
                });
                
                // FAB
                elements.fabBtn.addEventListener('click', () => this.showQuickActions());
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        elements.studentSearch.focus();
                    }
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.alert').forEach(alert => alert.remove());
                    }
                });
            }

            static setupAuthListener() {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        AppState.currentUser = user;
                        elements.logoutBtn.classList.remove('hidden');
                        
                        // Check if user has a school
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            AppState.userRole = userData.role;
                            
                            if (userData.schoolCode) {
                                await SchoolManager.loadSchool(userData.schoolCode);
                                this.showDashboard();
                            } else if (userData.role === 'admin') {
                                this.showSchoolSetup();
                            }
                        }
                    } else {
                        AppState.currentUser = null;
                        elements.authSection.classList.remove('hidden');
                        elements.mainDashboard.classList.add('hidden');
                        elements.logoutBtn.classList.add('hidden');
                    }
                });
            }

            static setupDateDefaults() {
                // Set today's date for attendance
                const today = new Date().toISOString().split('T')[0];
                if (elements.attendanceDate) {
                    elements.attendanceDate.value = today;
                }
                
                // Set current month for reports
                const currentMonth = new Date().toISOString().slice(0, 7);
                if (elements.reportMonth) {
                    elements.reportMonth.value = currentMonth;
                }
            }

            static async handleLogin() {
                const email = elements.email.value.trim();
                const password = elements.password.value.trim();
                
                if (!email || !password) {
                    Utils.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'warning');
                    return;
                }
                
                elements.loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                elements.loginBtn.disabled = true;
                
                await AuthManager.login(email, password);
                
                elements.loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                elements.loginBtn.disabled = false;
            }

            static async handleRegister() {
                const email = elements.email.value.trim();
                const password = elements.password.value.trim();
                const role = elements.userRole.value;
                
                if (!email || !password || !role) {
                    Utils.showNotification('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
                    return;
                }
                
                if (!Utils.validateEmail(email)) {
                    Utils.showNotification('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­', 'warning');
                    return;
                }
                
                elements.registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
                elements.registerBtn.disabled = true;
                
                await AuthManager.register(email, password, role);
                
                elements.registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                elements.registerBtn.disabled = false;
            }

            static togglePasswordVisibility() {
                const passwordField = elements.password;
                const toggleIcon = elements.togglePassword.querySelector('i');
                
                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    toggleIcon.className = 'fas fa-eye-slash';
                } else {
                    passwordField.type = 'password';
                    toggleIcon.className = 'fas fa-eye';
                }
            }

            static toggleTheme() {
                if (AppState.theme === 'light') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
                    AppState.theme = 'dark';
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†';
                    AppState.theme = 'light';
                    localStorage.setItem('theme', 'light');
                }
            }

         static async handleSaveSchool() {
    const schoolData = {
        name: elements.schoolName.value.trim(),
        code: elements.schoolCode.value.trim(),
        province: elements.province.value,
        phone: elements.schoolPhone.value.trim()
    };
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    if (!schoolData.name || !schoolData.code) {
        Utils.showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ', 'warning');
        return;
    }
    
    elements.saveSchoolBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
    elements.saveSchoolBtn.disabled = true;
    
    try {
        const success = await SchoolManager.createSchool(schoolData);
        
        if (success) {
            // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            elements.saveSchoolBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
            
            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
            setTimeout(() => {
                this.showUploadSection();
            }, 1000);
        } else {
            elements.saveSchoolBtn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            elements.saveSchoolBtn.disabled = false;
        }
    } catch (error) {
        console.error('Error saving school:', error);
        elements.saveSchoolBtn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
        elements.saveSchoolBtn.disabled = false;
    }
}   

            static async showDashboard() {
                elements.authSection.classList.add('hidden');
                elements.schoolSetupSection.classList.add('hidden');
                elements.uploadSection.classList.add('hidden');
                elements.mainDashboard.classList.remove('hidden');
                
                // Show admin tab for admin users
                if (AppState.userRole === 'admin') {
                    elements.adminTab.classList.remove('hidden');
                }
                
                // Load initial data
                await Promise.all([
                    StudentsManager.loadStudents(),
                    TeachersManager.loadTeachers()
                ]);
                
                // Initialize charts
                this.initCharts();
            }

            static switchSection(sectionId) {
                // Update active tab
                elements.navTabs.forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.section === sectionId);
                });
                
                // Hide all sections
                document.querySelectorAll('.dashboard-section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show selected section
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('hidden');
                }
            }

            static showAddStudentModal() {
                Swal.fire({
                    title: 'Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ° Ø¬Ø¯ÙŠØ¯',
                    html: `
                        <input id="add-firstName" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù…">
                        <input id="add-lastName" class="swal2-input" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
                        <input id="add-class" class="swal2-input" placeholder="Ø§Ù„Ù‚Ø³Ù…">
                        <input id="add-birthDate" type="date" class="swal2-input" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
                        <input id="add-parentPhone" class="swal2-input" placeholder="Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
                        <select id="add-gender" class="swal2-input">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                            <option value="male">Ø°ÙƒØ±</option>
                            <option value="female">Ø£Ù†Ø«Ù‰</option>
                        </select>
                    `,
                    focusConfirm: false,
                    showCancelButton: true,
                    confirmButtonText: 'Ø¥Ø¶Ø§ÙØ©',
                    cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                    preConfirm: () => {
                        return {
                            firstName: document.getElementById('add-firstName').value,
                            lastName: document.getElementById('add-lastName').value,
                            class: document.getElementById('add-class').value,
                            birthDate: document.getElementById('add-birthDate').value,
                            parentPhone: document.getElementById('add-parentPhone').value,
                            gender: document.getElementById('add-gender').value
                        };
                    }
                }).then(async (result) => {
                    if (result.isConfirmed && result.value) {
                        await StudentsManager.addStudent(result.value);
                    }
                });
            }

            static showQuickActions() {
                const actions = {
                    'Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ°': () => this.showAddStudentModal(),
                    'Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø°': () => this.showAddTeacherModal(),
                    'ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±': () => this.switchSection('attendance'),
                    'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±': () => this.switchSection('reports'),
                    'Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©': () => this.createBackup()
                };
                
                Swal.fire({
                    title: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©',
                    html: Object.keys(actions).map(action => 
                        `<button class="btn btn-primary" style="margin: 5px; width: 200px;" onclick="UIManager.quickAction('${action}')">${action}</button>`
                    ).join('<br>'),
                    showConfirmButton: false,
                    showCloseButton: true
                });
            }

            static quickAction(action) {
                const actions = {
                    'Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ°': () => this.showAddStudentModal(),
                    'Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø°': () => this.showAddTeacherModal(),
                    'ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±': () => this.switchSection('attendance'),
                    'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±': () => this.switchSection('reports'),
                    'Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©': () => this.createBackup()
                };
                
                Swal.close();
                if (actions[action]) actions[action]();
            }

            static async createBackup() {
                try {
                    Utils.showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...', 'info');
                    
                    // Collect all data
                    const backupData = {
                        school: AppState.currentSchool,
                        students: StudentsManager.students,
                        teachers: TeachersManager.teachers,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Convert to JSON and create blob
                    const json = JSON.stringify(backupData, null, 2);
                    const blob = new Blob([json], { type: 'application/json' });
                    
                    // Create download link
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `backup_${AppState.currentSchool?.id}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    Utils.showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } catch (error) {
                    console.error('Backup error:', error);
                    Utils.showNotification('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
                }
            }

            static initCharts() {
                // Initialize Chart.js charts
                const ctx = document.getElementById('classesChart');
                if (ctx) {
                    // Get class distribution from students
                    const classDistribution = {};
                    StudentsManager.students.forEach(student => {
                        const className = student.class || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        classDistribution[className] = (classDistribution[className] || 0) + 1;
                    });
                    
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(classDistribution),
                            datasets: [{
                                data: Object.values(classDistribution),
                                backgroundColor: [
                                    '#006233', '#2E7D32', '#4CAF50', '#81C784',
                                    '#2196F3', '#1976D2', '#FF9800', '#FF5722'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    rtl: true,
                                    labels: {
                                        font: {
                                            family: 'Cairo',
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            static showAddTeacherModal() {
                Swal.fire({
                    title: 'Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø° Ø¬Ø¯ÙŠØ¯',
                    html: `
                        <input id="add-teacherName" class="swal2-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                        <input id="add-teacherSubject" class="swal2-input" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©">
                        <input id="add-teacherEmail" class="swal2-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                        <input id="add-teacherPhone" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                        <input id="add-teacherHireDate" type="date" class="swal2-input" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†">
                    `,
                    focusConfirm: false,
                    showCancelButton: true,
                    confirmButtonText: 'Ø¥Ø¶Ø§ÙØ©',
                    cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                }).then(async (result) => {
                    if (result.isConfirmed) {
                        // Implementation for adding teacher
                        Utils.showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    }
                });
            }
        }

        // ============================================
        // INITIALIZE APPLICATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            UIManager.init();
            
            // Set current date for attendance
            const today = new Date().toISOString().split('T')[0];
            if (elements.attendanceDate) {
                elements.attendanceDate.value = today;
                elements.attendanceDate.max = today;
            }
            
            // Set current month for reports
            const currentMonth = new Date().toISOString().slice(0, 7);
            if (elements.reportMonth) {
                elements.reportMonth.value = currentMonth;
            }
            
            // Apply saved theme
            if (AppState.theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
            }
        });

        // Make UIManager available globally for quick actions
        window.UIManager = UIManager;
        window.StudentsManager = StudentsManager;

        // Service Worker Registration (for PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // Offline detection
        window.addEventListener('online', () => {
            Utils.showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
        });

        window.addEventListener('offline', () => {
            Utils.showNotification('Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'warning');
        });
    </script>
</body>
</html>
